C51 COMPILER V9.59.0.0   BSP_UART1                                                         09/26/2018 10:49:56 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE BSP_UART1
OBJECT MODULE PLACED IN .\Objects\bsp_uart1.obj
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE ..\bsp\bsp_uart1.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\lib;..\user;..\bsp;.
                    -.\Time_Out) DEBUG OBJECTEXTEND PRINT(.\Listings\bsp_uart1.lst) TABS(2) OBJECT(.\Objects\bsp_uart1.obj)

line level    source

   1          #include "bsp_uart1.h"
   2          #include "string.h"
   3          
   4          extern unsigned char Uart1SendFlag,Uart1ReceiveFlag;
   5          /*****************************************************
   6          *函数名称：void Uart1_Init(uint Freq,unsigned long int baud)
   7          *函数功能：Uart1中断初始化
   8          *入口参数：Freq-主频，baud-波特率
   9          *出口参数：Freq,baud
  10          *****************************************************/
  11          void Uart1_Init(unsigned int Freq)
  12          {
  13   1        P1CON &= 0xF5;   //TX设置为强推挽输出高，RX设置为输入带上拉
  14   1        P1PH  |= 0x0A;
  15   1        
  16   1        OTCON = 0xC0;    //串行接口SSI选择Uart1通信
  17   1        SSCON0 = 0x50;   //设置通信方式为模式一，允许接收
  18   1        SSCON1 = Freq*1000000/baud;   //波特率低位控制
  19   1        SSCON2 = (Freq*1000000/baud)>>8;   //波特率高位控制
  20   1        IE1 = 0x01;      //开启SSI中断
  21   1      }
  22          
  23          void BackCall_Uart1(unsigned int Freq,void (*ptr)(unsigned int))
  24          {
  25   1        (*ptr)(Freq);
  26   1      }
  27          
  28          void Uart1_Buf_TX(unsigned char DATA)
  29          {
  30   1        SSDAT = DATA;
  31   1        while(!Uart1SendFlag);
  32   1        Uart1SendFlag = 0;
  33   1      }
  34          
  35          unsigned char Send_Data(PROTOCOL_TX *p)
  36          {
  37   1        unsigned char i;
  38   1        for(i = 0 ;i < BUF_SIZE; i++)
  39   1        {
  40   2          Uart1_Buf_TX(p->Buf[i]);
  41   2        }
  42   1        return 1;
  43   1      }
  44          
  45          unsigned char Protocol_tx(unsigned char addr,unsigned char id,unsigned char TX_DATA)
  46          {
  47   1        PROTOCOL_TX buf;
  48   1        memset(&buf,0,sizeof(buf));
  49   1        buf.Buf_Format_t.ADDR       = addr;
  50   1        buf.Buf_Format_t.ID         = id;
  51   1        buf.Buf_Format_t.DATA1      = Hight(TX_DATA);
  52   1        buf.Buf_Format_t.DATA2      = Low(TX_DATA);
  53   1        buf.Buf_Format_t.CHECKSUM   = (unsigned char)(buf.Buf_Format_t.ADDR + buf.Buf_Format_t.ID + buf.Buf_Forma
             -t_t.DATA1 + buf.Buf_Format_t.DATA2);
C51 COMPILER V9.59.0.0   BSP_UART1                                                         09/26/2018 10:49:56 PAGE 2   

  54   1        buf.Buf_Format_t.STOP1      = 0x0d;
  55   1        buf.Buf_Format_t.STOP2      = 0x0a;
  56   1        return Send_Data(&buf);
  57   1      }
  58          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    201    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
