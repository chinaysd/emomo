C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE SYSTEM
OBJECT MODULE PLACED IN .\Objects\system.obj
COMPILER INVOKED BY: E:\MDK\C51\BIN\C51.EXE ..\user\system.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\lib;..\user;..\bsp;..\Ti
                    -me_Out) DEBUG OBJECTEXTEND PRINT(.\Listings\system.lst) OBJECT(.\Objects\system.obj)

line level    source

   1          #include "system.h"
   2          static unsigned char Cnt;
   3          unsigned char Uart1SendFlag,Uart1ReceiveFlag;
   4          
   5          TIMEOUT_PARA TimeOut_Para[2],Key_Para[2];
   6          KEY_PARA_TX KEY_Para_tx;
   7          unsigned char flag;
   8          unsigned char Reset_Flag,first_flag,second_flag;
   9          
  10          /************************************************* 所有功能标志定义***************************************
             -****************/
  11           
  12          unsigned char PUSH_RESET_FLAG,PUSH_STOP_FLAG,
  13                              LUMBER_OPEN_FLAG,LUMBER_CLOSE_FLAG,
  14                        HEAD_OPEN_FLAG,HEAD_CLOSE_FLAG,
  15                        PUSH_OPEN_FLAG,PUSH_CLOSE_FLAG,
  16           
  17                        FOOT_STATUS_FLAG,Close_Foot_Led_Flag,
  18                        Mass_Open_Flag,Mass_Close_Flag,
  19                        Heat_Open_Flag,Heat_Close_Flag,
  20                        
  21                        Sleep_Position_Flag,Set_Sleep_Position_Flag,
  22                        Watch_TV_Position_Flag,Set_Watch_TV_Position_Flag,
  23                        Reading_Position_Flag,Set_Reading_Position_Flag,
  24                                                            COOL_STATUS_FLAG;
  25          /*********************************************************************************************************
             -***************/
  26          
  27          
  28          /***************************************************接收数据的定义****************************************
             -***************/
  29          
  30          unsigned int i;
  31          unsigned int res;
  32          static unsigned char rev_num;
  33          unsigned int temp;
  34          PROTOCOL_TX rev_para;
  35          unsigned char sum;
  36          unsigned char Rev_Buf[Rev_Byte_Num];
  37          
  38          /*********************************************************************************************************
             -***************/
  39          
  40          #if 1
  41          unsigned char Rev_Data(void)
  42          {
  43   1              return SSDAT;
  44   1      }
  45          unsigned char Serial_Get_Status(void)
  46          {
  47   1              if(rev_num & 0x80)
  48   1              {
  49   2                      rev_num = 0;
  50   2                      return 1;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 2   

  51   2              }
  52   1              else
  53   1              {
  54   2                      return 0;
  55   2              }
  56   1      }
  57          
  58          void Serial_Rev_IQH(void)
  59          {
  60   1              res = Rev_Data();
  61   1              
  62   1              if((rev_num & 0x80) == 0)
  63   1              {
  64   2                      if(rev_num & 0x40)
  65   2                      {
  66   3                              if(res == 0xFB)
  67   3                              {
  68   4                                      rev_num |= 0x80;
  69   4                              }
  70   3                              else
  71   3                              {
  72   4                                      rev_num = 0;
  73   4                              }
  74   3                      }
  75   2                      else
  76   2                      {
  77   3                     if(rev_num == 5){
  78   4                      if(res == sum)
  79   4                      {
  80   5                          rev_num |= 0x40;                            
  81   5                      }       else{
  82   5                          rev_num = 0;
  83   5                      }       
  84   4                  }
  85   3                              //else
  86   3                              {
  87   4                                      Rev_Buf[rev_num] = res;
  88   4                                      rev_num++;
  89   4                                      sum = (unsigned char)((Rev_Buf[0])+(Rev_Buf[1])+(Rev_Buf[2])+(Rev_Buf[3])+(Rev_Buf[4]));
  90   4                                      if(Rev_Buf[0] != 0xA5)
  91   4                                      {
  92   5                                              rev_num = 0;
  93   5                                      }
  94   4      //                              if(rev_num > Rev_Byte_Num)
  95   4      //                              {
  96   4      //                                      rev_num = 0;
  97   4      //                              }
  98   4                              }
  99   3                      }
 100   2              }
 101   1              
 102   1      }
 103          #endif
 104          
 105          void Key_Scanf(void)
 106          {
 107   1              switch (KEY_Para_tx.KEY_VALUE)
 108   1              {
 109   2                              case KEY_LOOP_NUM0://座椅打开按键
 110   2                                                                                                              if(RESET_KEY1_DOWN)
 111   2                                                                                                              {
 112   3                                                                                                                      if(!KEY_Para_tx.RESET_KEY1_FLAG)
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 3   

 113   3                                                                                                                      {
 114   4                                                                                                                              KEY_Para_tx.RESET_KEY1_FLAG = True;
 115   4                                                                                                                              TimeOut_Record(&Key_Para[0],Shakes_Time);
 116   4                                                                                                                      }
 117   3                                                                                                                      if((TimeOutDet_Check(&Key_Para[0]))&&(RESET_KEY1_DOWN))
 118   3                                                                                                                      {
 119   4                                                                                                                              flag = 0;
 120   4                                                                                                                              PUSH_RESET_FLAG   = 0;
 121   4                                                                                                                              LUMBER_OPEN_FLAG  = 0; 
 122   4                                                                                                                              LUMBER_CLOSE_FLAG = 0;
 123   4                                                                                                                              HEAD_OPEN_FLAG    = 0;
 124   4                                                                                                                              HEAD_CLOSE_FLAG   = 0;
 125   4                                                                                                                              PUSH_OPEN_FLAG    = 1;
 126   4                                                                                                                              PUSH_CLOSE_FLAG   = 0;
 127   4                                                                                                                              PUSH_STOP_FLAG    = 0;
 128   4                                                                                                                              FOOT_STATUS_FLAG  = 0;
 129   4                                                                                                                              COOL_STATUS_FLAG  = 0;
 130   4                                                                                                                              Close_Foot_Led_Flag = 0;
 131   4                                                                              
 132   4                                                                                                                              Mass_Open_Flag  = 0;
 133   4                                                                                                                              Mass_Close_Flag = 0;
 134   4                                                                                                                              Heat_Open_Flag  = 0;
 135   4                                                                                                                              Heat_Close_Flag = 0;
 136   4                                                                              
 137   4                                                                                                                              Sleep_Position_Flag        = 0;
 138   4                                                                                                                              Set_Sleep_Position_Flag    = 0;
 139   4      
 140   4                                                                                                                              Watch_TV_Position_Flag     = 0;
 141   4                                                                                                                              Set_Watch_TV_Position_Flag = 0;
 142   4      
 143   4                                                                                                                              Reading_Position_Flag      = 0;
 144   4                                                                                                                              Set_Reading_Position_Flag  = 0;
 145   4                                                                                                                      }       
 146   3                                                                                                              }
 147   2                                                                                                              KEY_Para_tx.KEY_VALUE = KEY_LOOP_NUM1;
 148   2                                                                                                              break;
 149   2                              case KEY_LOOP_NUM1://腰靠打开按键
 150   2                                                                                                              if(LEFT_KEY2_DOWN)
 151   2                                                                                                              {
 152   3                                                                                                                      if(!KEY_Para_tx.RESET_KEY1_FLAG)
 153   3                                                                                                                      {
 154   4                                                                                                                              KEY_Para_tx.RESET_KEY1_FLAG = True;
 155   4                                                                                                                              TimeOut_Record(&Key_Para[0],Shakes_Time);
 156   4                                                                                                                      }
 157   3                                                                                                                      if((TimeOutDet_Check(&Key_Para[0]))&&(LEFT_KEY2_DOWN))
 158   3                                                                                                                      {
 159   4                                                                                                                              flag = 0;
 160   4                                                                                                                              PUSH_RESET_FLAG   = 0;
 161   4                                                                                                                              LUMBER_OPEN_FLAG  = 1; 
 162   4                                                                                                                              LUMBER_CLOSE_FLAG = 0;
 163   4                                                                                                                              HEAD_OPEN_FLAG    = 0;
 164   4                                                                                                                              HEAD_CLOSE_FLAG   = 0;
 165   4                                                                                                                              PUSH_OPEN_FLAG    = 0;
 166   4                                                                                                                              PUSH_CLOSE_FLAG   = 0;
 167   4                                                                                                                              PUSH_STOP_FLAG    = 0;
 168   4                                                                                                                              FOOT_STATUS_FLAG  = 0;
 169   4                                                                                                                              COOL_STATUS_FLAG  = 0;
 170   4                                                                                                                              Close_Foot_Led_Flag = 0;
 171   4                                                                              
 172   4                                                                                                                              Mass_Open_Flag  = 0;
 173   4                                                                                                                              Mass_Close_Flag = 0;
 174   4                                                                                                                              Heat_Open_Flag  = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 4   

 175   4                                                                                                                              Heat_Close_Flag = 0;
 176   4                                                                              
 177   4                                                                                                                              Sleep_Position_Flag        = 0;
 178   4                                                                                                                              Set_Sleep_Position_Flag    = 0;
 179   4      
 180   4                                                                                                                              Watch_TV_Position_Flag     = 0;
 181   4                                                                                                                              Set_Watch_TV_Position_Flag = 0;
 182   4      
 183   4                                                                                                                              Reading_Position_Flag      = 0;
 184   4                                                                                                                              Set_Reading_Position_Flag  = 0;
 185   4                                                                                                                      }       
 186   3                                                                                                              }
 187   2                                                                                                              KEY_Para_tx.KEY_VALUE = KEY_LOOP_NUM2;
 188   2                                                                                                              break;
 189   2                              case KEY_LOOP_NUM2://腰靠收回按键
 190   2                                                                                                              if(RIGHT_KEY3_DOWN)
 191   2                                                                                                              {
 192   3                                                                                                                      if(!KEY_Para_tx.RESET_KEY1_FLAG)
 193   3                                                                                                                      {
 194   4                                                                                                                              KEY_Para_tx.RESET_KEY1_FLAG = True;
 195   4                                                                                                                              TimeOut_Record(&Key_Para[0],Shakes_Time);
 196   4                                                                                                                      }
 197   3                                                                                                                      if((TimeOutDet_Check(&Key_Para[0]))&&(RIGHT_KEY3_DOWN))
 198   3                                                                                                                      {
 199   4                                                                                                                              flag = 0;                                                                                                                       
 200   4                                                                                                                              PUSH_RESET_FLAG   = 0;
 201   4                                                                                                                              LUMBER_OPEN_FLAG  = 0; 
 202   4                                                                                                                              LUMBER_CLOSE_FLAG = 1;
 203   4                                                                                                                              HEAD_OPEN_FLAG    = 0;
 204   4                                                                                                                              HEAD_CLOSE_FLAG   = 0;
 205   4                                                                                                                              PUSH_OPEN_FLAG    = 0;
 206   4                                                                                                                              PUSH_CLOSE_FLAG   = 0;
 207   4                                                                                                                              PUSH_STOP_FLAG    = 0;
 208   4                                                                                                                              FOOT_STATUS_FLAG  = 0;
 209   4                                                                                                                              COOL_STATUS_FLAG  = 0;
 210   4                                                                                                                              Close_Foot_Led_Flag = 0;
 211   4                                                                              
 212   4                                                                                                                              Mass_Open_Flag  = 0;
 213   4                                                                                                                              Mass_Close_Flag = 0;
 214   4                                                                                                                              Heat_Open_Flag  = 0;
 215   4                                                                                                                              Heat_Close_Flag = 0;
 216   4                                                                              
 217   4                                                                                                                              Sleep_Position_Flag        = 0;
 218   4                                                                                                                              Set_Sleep_Position_Flag    = 0;
 219   4      
 220   4                                                                                                                              Watch_TV_Position_Flag     = 0;
 221   4                                                                                                                              Set_Watch_TV_Position_Flag = 0;
 222   4      
 223   4                                                                                                                              Reading_Position_Flag      = 0;
 224   4                                                                                                                              Set_Reading_Position_Flag  = 0;
 225   4                                                                                                                      }       
 226   3                                                                                                              }
 227   2                                                                                                              KEY_Para_tx.KEY_VALUE = KEY_LOOP_NUM3;
 228   2                                                                                                              break;
 229   2                              case KEY_LOOP_NUM3:// 复位按键
 230   2                                                                                                              if(FOUR_LEFT_KEY4_DOWN)
 231   2                                                                                                              {
 232   3                                                                                                                      if(!KEY_Para_tx.RESET_KEY1_FLAG)
 233   3                                                                                                                      {
 234   4                                                                                                                              KEY_Para_tx.RESET_KEY1_FLAG = True;
 235   4                                                                                                                              TimeOut_Record(&Key_Para[0],Shakes_Time);
 236   4                                                                                                                      }
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 5   

 237   3                                                                                                                      if((TimeOutDet_Check(&Key_Para[0]))&&(FOUR_LEFT_KEY4_DOWN))
 238   3                                                                                                                      {
 239   4                                                                                                                              flag = 0;
 240   4                                                                                                                              PUSH_RESET_FLAG   = 1;
 241   4                                                                                                                              LUMBER_OPEN_FLAG  = 0; 
 242   4                                                                                                                              LUMBER_CLOSE_FLAG = 0;
 243   4                                                                                                                              HEAD_OPEN_FLAG    = 0;
 244   4                                                                                                                              HEAD_CLOSE_FLAG   = 0;
 245   4                                                                                                                              PUSH_OPEN_FLAG    = 0;
 246   4                                                                                                                              PUSH_CLOSE_FLAG   = 0;
 247   4                                                                                                                              PUSH_STOP_FLAG    = 0;
 248   4                                                                                                                              FOOT_STATUS_FLAG  = 0;
 249   4                                                                                                                              COOL_STATUS_FLAG  = 0;
 250   4                                                                                                                              Close_Foot_Led_Flag = 0;
 251   4                                                                              
 252   4                                                                                                                              Mass_Open_Flag  = 0;
 253   4                                                                                                                              Mass_Close_Flag = 0;
 254   4                                                                                                                              Heat_Open_Flag  = 0;
 255   4                                                                                                                              Heat_Close_Flag = 0;
 256   4                                                                              
 257   4                                                                                                                              Sleep_Position_Flag        = 0;
 258   4                                                                                                                              Set_Sleep_Position_Flag    = 0;
 259   4      
 260   4                                                                                                                              Watch_TV_Position_Flag     = 0;
 261   4                                                                                                                              Set_Watch_TV_Position_Flag = 0;
 262   4      
 263   4                                                                                                                              Reading_Position_Flag      = 0;
 264   4                                                                                                                              Set_Reading_Position_Flag  = 0;
 265   4                                                                                                                      }       
 266   3                                                                                                              }
 267   2                                                                                                              KEY_Para_tx.KEY_VALUE = KEY_LOOP_NUM4;
 268   2                                                                                                              break;
 269   2                              case KEY_LOOP_NUM4://头枕打开
 270   2                                                        #if 1                   
 271   2                                                                                                              if(FOUR_RIGHT_KEY5_DOWN)
 272   2                                                                                                              {
 273   3                                                                                                                      if(!KEY_Para_tx.RESET_KEY1_FLAG)
 274   3                                                                                                                      {
 275   4                                                                                                                              KEY_Para_tx.RESET_KEY1_FLAG = True;
 276   4                                                                                                                              TimeOut_Record(&Key_Para[0],Shakes_Time);
 277   4                                                                                                                      }
 278   3                                                                                                                      if((TimeOutDet_Check(&Key_Para[0]))&&(FOUR_RIGHT_KEY5_DOWN))
 279   3                                                                                                                      {
 280   4                                                                                                                              flag = 0;
 281   4                                                                                                                              PUSH_RESET_FLAG   = 0;
 282   4                                                                                                                              LUMBER_OPEN_FLAG  = 0; 
 283   4                                                                                                                              LUMBER_CLOSE_FLAG = 0;
 284   4                                                                                                                              HEAD_OPEN_FLAG    = 1;
 285   4                                                                                                                              HEAD_CLOSE_FLAG   = 0;
 286   4                                                                                                                              PUSH_OPEN_FLAG    = 0;
 287   4                                                                                                                              PUSH_CLOSE_FLAG   = 0;
 288   4                                                                                                                              PUSH_STOP_FLAG    = 0;
 289   4                                                                                                                              FOOT_STATUS_FLAG  = 0;
 290   4                                                                                                                              COOL_STATUS_FLAG  = 0;
 291   4                                                                                                                              Close_Foot_Led_Flag = 0;
 292   4                                                                              
 293   4                                                                                                                              Mass_Open_Flag  = 0;
 294   4                                                                                                                              Mass_Close_Flag = 0;
 295   4                                                                                                                              Heat_Open_Flag  = 0;
 296   4                                                                                                                              Heat_Close_Flag = 0;
 297   4                                                                              
 298   4                                                                                                                              Sleep_Position_Flag        = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 6   

 299   4                                                                                                                              Set_Sleep_Position_Flag    = 0;
 300   4      
 301   4                                                                                                                              Watch_TV_Position_Flag     = 0;
 302   4                                                                                                                              Set_Watch_TV_Position_Flag = 0;
 303   4      
 304   4                                                                                                                              Reading_Position_Flag      = 0;
 305   4                                                                                                                              Set_Reading_Position_Flag  = 0;
 306   4                                                                                                                      }       
 307   3                                                                                                              }
 308   2                                                                                                              #endif
 309   2                                                                                                              KEY_Para_tx.KEY_VALUE = KEY_LOOP_NUM5;
 310   2                                                                                                              break;
 311   2                              case KEY_LOOP_NUM5://头枕收回
 312   2                                                        #if 1                    
 313   2                                                                                                              if(FOUR_GETUP_KEY6_DOWN)//四向向上拨动接触点向下开关按键
 314   2                                                                                                              {
 315   3                                                                                                                      if(!KEY_Para_tx.RESET_KEY1_FLAG)
 316   3                                                                                                                      {
 317   4                                                                                                                              KEY_Para_tx.RESET_KEY1_FLAG = True;
 318   4                                                                                                                              TimeOut_Record(&Key_Para[0],Shakes_Time);
 319   4                                                                                                                      }
 320   3                                                                                                                      if((TimeOutDet_Check(&Key_Para[0]))&&(FOUR_GETUP_KEY6_DOWN))
 321   3                                                                                                                      {
 322   4                                                                                                                              flag = 0;
 323   4                                                                                                                              PUSH_RESET_FLAG   = 0;
 324   4                                                                                                                              LUMBER_OPEN_FLAG  = 0; 
 325   4                                                                                                                              LUMBER_CLOSE_FLAG = 0;
 326   4                                                                                                                              HEAD_OPEN_FLAG    = 0;
 327   4                                                                                                                              HEAD_CLOSE_FLAG   = 1;
 328   4                                                                                                                              PUSH_OPEN_FLAG    = 0;
 329   4                                                                                                                              PUSH_CLOSE_FLAG   = 0;
 330   4                                                                                                                              PUSH_STOP_FLAG    = 0;
 331   4                                                                                                                              FOOT_STATUS_FLAG  = 0;
 332   4                                                                                                                              COOL_STATUS_FLAG  = 0;
 333   4                                                                                                                              Close_Foot_Led_Flag = 0;
 334   4                                                                              
 335   4                                                                                                                              Mass_Open_Flag  = 0;
 336   4                                                                                                                              Mass_Close_Flag = 0;
 337   4                                                                                                                              Heat_Open_Flag  = 0;
 338   4                                                                                                                              Heat_Close_Flag = 0;
 339   4                                                                              
 340   4                                                                                                                              Sleep_Position_Flag        = 0;
 341   4                                                                                                                              Set_Sleep_Position_Flag    = 0;
 342   4      
 343   4                                                                                                                              Watch_TV_Position_Flag     = 0;
 344   4                                                                                                                              Set_Watch_TV_Position_Flag = 0;
 345   4      
 346   4                                                                                                                              Reading_Position_Flag      = 0;
 347   4                                                                                                                              Set_Reading_Position_Flag  = 0;
 348   4                                                                                                                      }       
 349   3                                                                                                              }
 350   2                                                                                                              #endif
 351   2                                                                                                              KEY_Para_tx.KEY_VALUE = KEY_LOOP_NUM6;
 352   2                                                                                                              break;
 353   2                              case KEY_LOOP_NUM6://座椅收回按键
 354   2                                                                                                              if(FOUR_GETDOWN_KEY7_DOWN)
 355   2                                                                                                              {
 356   3                                                                                                                      if(!KEY_Para_tx.RESET_KEY1_FLAG)
 357   3                                                                                                                      {
 358   4                                                                                                                              KEY_Para_tx.RESET_KEY1_FLAG = True;
 359   4                                                                                                                              TimeOut_Record(&Key_Para[0],Shakes_Time);
 360   4                                                                                                                      }
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 7   

 361   3                                                                                                                      if((TimeOutDet_Check(&Key_Para[0]))&&(FOUR_GETDOWN_KEY7_DOWN))
 362   3                                                                                                                      {
 363   4                                                                                                                              flag = 0;
 364   4                                                                                                                              PUSH_RESET_FLAG   = 0;
 365   4                                                                                                                              LUMBER_OPEN_FLAG  = 0; 
 366   4                                                                                                                              LUMBER_CLOSE_FLAG = 0;
 367   4                                                                                                                              HEAD_OPEN_FLAG    = 0;
 368   4                                                                                                                              HEAD_CLOSE_FLAG   = 0;
 369   4                                                                                                                              PUSH_OPEN_FLAG    = 0;
 370   4                                                                                                                              PUSH_CLOSE_FLAG   = 1;
 371   4                                                                                                                              PUSH_STOP_FLAG    = 0;
 372   4                                                                                                                              FOOT_STATUS_FLAG  = 0;
 373   4                                                                                                                              COOL_STATUS_FLAG  = 0;
 374   4                                                                                                                              Close_Foot_Led_Flag = 0;
 375   4                                                                              
 376   4                                                                                                                              Mass_Open_Flag  = 0;
 377   4                                                                                                                              Mass_Close_Flag = 0;
 378   4                                                                                                                              Heat_Open_Flag  = 0;
 379   4                                                                                                                              Heat_Close_Flag = 0;
 380   4                                                                              
 381   4                                                                                                                              Sleep_Position_Flag        = 0;
 382   4                                                                                                                              Set_Sleep_Position_Flag    = 0;
 383   4      
 384   4                                                                                                                              Watch_TV_Position_Flag     = 0;
 385   4                                                                                                                              Set_Watch_TV_Position_Flag = 0;
 386   4      
 387   4                                                                                                                              Reading_Position_Flag      = 0;
 388   4                                                                                                                              Set_Reading_Position_Flag  = 0;
 389   4                                                                                                                      }       
 390   3                                                                                                              }
 391   2                                                                                                              
 392   2                                                                                                              #if 1
 393   2                                                                                                              if(RESET_KEY1_UP && LEFT_KEY2_UP && RIGHT_KEY3_UP && FOUR_LEFT_KEY4_UP && FOUR_RIGHT_KEY5_UP 
             -&& FOUR_GETUP_KEY6_UP && FOUR_GETDOWN_KEY7_UP)
 394   2                                                                                                              {
 395   3                                                                                                                      
 396   3                                                                                                                      if(!flag)
 397   3                                                                                                                      {
 398   4                                                                                                                              flag = 1;
 399   4                                                                                                                              KEY_Para_tx.RESET_KEY1_FLAG = False;
 400   4                                                                                                                              PUSH_RESET_FLAG   = 0;
 401   4                                                                                                                              LUMBER_OPEN_FLAG  = 0; 
 402   4                                                                                                                              LUMBER_CLOSE_FLAG = 0;
 403   4                                                                                                                              HEAD_OPEN_FLAG    = 0;
 404   4                                                                                                                              HEAD_CLOSE_FLAG   = 0;
 405   4                                                                                                                              PUSH_OPEN_FLAG    = 0;
 406   4                                                                                                                              PUSH_CLOSE_FLAG   = 0;
 407   4                                                                                                                              PUSH_STOP_FLAG    = 1;
 408   4                                                                                                                              FOOT_STATUS_FLAG  = 0;
 409   4                                                                                                                              COOL_STATUS_FLAG  = 0;
 410   4                                                                                                                              Close_Foot_Led_Flag = 0;
 411   4                                                                              
 412   4                                                                                                                              Mass_Open_Flag  = 0;
 413   4                                                                                                                              Mass_Close_Flag = 0;
 414   4                                                                                                                              Heat_Open_Flag  = 0;
 415   4                                                                                                                              Heat_Close_Flag = 0;
 416   4                                                                              
 417   4                                                                                                                              Sleep_Position_Flag        = 0;
 418   4                                                                                                                              Set_Sleep_Position_Flag    = 0;
 419   4      
 420   4                                                                                                                              Watch_TV_Position_Flag     = 0;
 421   4                                                                                                                              Set_Watch_TV_Position_Flag = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 8   

 422   4      
 423   4                                                                                                                              Reading_Position_Flag      = 0;
 424   4                                                                                                                              Set_Reading_Position_Flag  = 0;
 425   4                                                                                                                      }
 426   3                                                                                                              }
 427   2                                                                                                              #endif
 428   2                                                                                                              KEY_Para_tx.KEY_VALUE = KEY_LOOP_NUM0;
 429   2                                                                                                              break;
 430   2                              default:
 431   2                                                                                                              KEY_Para_tx.KEY_VALUE = KEY_LOOP_NUM0;
 432   2                                                                                                              break;
 433   2                                      
 434   2                      }
 435   1      }
 436          
 437          void Key_Handle(void)
 438          {
 439   1              if(PUSH_RESET_FLAG)
 440   1              {
 441   2                      Protocol_tx(IC_ADDR,IC_ID,HOME_POSITION);
 442   2              }
 443   1              else if(LUMBER_OPEN_FLAG)
 444   1              {
 445   2                      Protocol_tx(IC_ADDR,IC_ID,LARBUM_UP);
 446   2              }
 447   1              else if(LUMBER_CLOSE_FLAG)
 448   1              {
 449   2                      Protocol_tx(IC_ADDR,IC_ID,LARBUM_DOWN);
 450   2              }
 451   1              else if(HEAD_OPEN_FLAG)
 452   1              {
 453   2                      Protocol_tx(IC_ADDR,IC_ID,HEAD_UP);
 454   2              }
 455   1              else if(HEAD_CLOSE_FLAG)
 456   1              {
 457   2                      Protocol_tx(IC_ADDR,IC_ID,HEAD_DOWN);
 458   2              }
 459   1              else if(PUSH_OPEN_FLAG)
 460   1              {
 461   2                      Protocol_tx(IC_ADDR,IC_ID,OPEN);
 462   2              }
 463   1              else if(PUSH_CLOSE_FLAG)
 464   1              {
 465   2                      Protocol_tx(IC_ADDR,IC_ID,CLOSE);
 466   2              }
 467   1              else if(PUSH_STOP_FLAG)
 468   1              {
 469   2                      Protocol_tx(IC_ADDR,IC_ID,STOP);
 470   2              }
 471   1              else if(FOOT_STATUS_FLAG)
 472   1              {
 473   2                      Protocol_tx(IC_ADDR,IC_ID,FOOT_LIGHT_OPEN);
 474   2              }
 475   1              else if(COOL_STATUS_FLAG)// 制冷没有关闭
 476   1              {
 477   2                      Protocol_tx(IC_ADDR,IC_ID,COOL_OPEN);
 478   2              }
 479   1              else if(Close_Foot_Led_Flag)
 480   1              {
 481   2                      Protocol_tx(IC_ADDR,IC_ID,FOOT_LIGHT_CLOSE);
 482   2              }
 483   1              else if(Mass_Open_Flag)
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 9   

 484   1              {
 485   2                      Protocol_tx(IC_ADDR,IC_ID,MASS_OPEN);
 486   2              }
 487   1              else if(Mass_Close_Flag)
 488   1              {
 489   2                      Protocol_tx(IC_ADDR,IC_ID,MASS_CLOSE);
 490   2              }
 491   1              else if(Heat_Open_Flag)
 492   1              {
 493   2                      Protocol_tx(IC_ADDR,IC_ID,HEAT_ON);
 494   2              }
 495   1              else if(Heat_Close_Flag)
 496   1              {
 497   2                      Protocol_tx(IC_ADDR,IC_ID,HEAT_OFF);
 498   2              }
 499   1              else if(Sleep_Position_Flag)
 500   1              {
 501   2                      Protocol_tx(IC_ADDR,IC_ID,SLEEP_POSITION);
 502   2              }
 503   1              else if(Set_Sleep_Position_Flag)
 504   1              {
 505   2                      Protocol_tx(IC_ADDR,IC_ID,SET_SLEEP_POSITION);
 506   2              }
 507   1              else if(Watch_TV_Position_Flag)
 508   1              {
 509   2                      Protocol_tx(IC_ADDR,IC_ID,WATCH_TV_POSITION);
 510   2              }
 511   1              else if(Set_Watch_TV_Position_Flag)
 512   1              {
 513   2                      Protocol_tx(IC_ADDR,IC_ID,SET_WATCH_TV_POSITION);
 514   2              }
 515   1              else if(Reading_Position_Flag)
 516   1              {
 517   2                      Protocol_tx(IC_ADDR,IC_ID,READING_POSITION);
 518   2              }
 519   1              else if(Set_Reading_Position_Flag)
 520   1              {
 521   2                      Protocol_tx(IC_ADDR,IC_ID,SET_READING_POSITION);
 522   2              }
 523   1      }
 524          
 525          void Rev_Data_Handle(void)
 526          {
 527   1               if(Serial_Get_Status())
 528   1               {
 529   2                      temp = (unsigned int)Get_32bit(Rev_Buf[3],Rev_Buf[4]);
 530   2                      memset(&Rev_Buf,0,sizeof(Rev_Buf));
 531   2                      switch (temp)
 532   2                      {
 533   3                              case COCO_Stop:                                 //停止
 534   3                                                #if 1
 535   3                                                PUSH_RESET_FLAG   = 0;
 536   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 537   3                                                                              LUMBER_CLOSE_FLAG = 0;
 538   3                                                                              HEAD_OPEN_FLAG    = 0;
 539   3                                                                              HEAD_CLOSE_FLAG   = 0;
 540   3                                                                              PUSH_OPEN_FLAG    = 0;
 541   3                                                                              PUSH_CLOSE_FLAG   = 0;
 542   3                                                                              PUSH_STOP_FLAG    = 1;
 543   3                                                                              FOOT_STATUS_FLAG  = 0;
 544   3                                                                              COOL_STATUS_FLAG  = 0;
 545   3                                          Close_Foot_Led_Flag = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 10  

 546   3                              
 547   3                                          Mass_Open_Flag  = 0;
 548   3                                                                              Mass_Close_Flag = 0;
 549   3                                                                              Heat_Open_Flag  = 0;
 550   3                                                                              Heat_Close_Flag = 0;
 551   3                              
 552   3                                          Sleep_Position_Flag        = 0;
 553   3                                                                              Set_Sleep_Position_Flag    = 0;
 554   3      
 555   3                                                                              Watch_TV_Position_Flag     = 0;
 556   3                                                                              Set_Watch_TV_Position_Flag = 0;
 557   3      
 558   3                                                                              Reading_Position_Flag      = 0;
 559   3                                                                              Set_Reading_Position_Flag  = 0;
 560   3                                          #endif
 561   3                                                break;
 562   3                              case COCO_Recline:                                //座椅打开
 563   3                                                #if 1                 
 564   3                                          PUSH_RESET_FLAG   = 0;
 565   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 566   3                                                                              LUMBER_CLOSE_FLAG = 0;
 567   3                                                                              HEAD_OPEN_FLAG    = 0;
 568   3                                                                              HEAD_CLOSE_FLAG   = 0;
 569   3                                                                              PUSH_OPEN_FLAG    = 1;
 570   3                                                                              PUSH_CLOSE_FLAG   = 0;
 571   3                                                                              PUSH_STOP_FLAG    = 0;
 572   3                                                                              FOOT_STATUS_FLAG  = 0;
 573   3                                                                              COOL_STATUS_FLAG  = 0;
 574   3                                          Close_Foot_Led_Flag = 0;
 575   3                              
 576   3                                          Mass_Open_Flag  = 0;
 577   3                                                                              Mass_Close_Flag = 0;
 578   3                                                                              Heat_Open_Flag  = 0;
 579   3                                                                              Heat_Close_Flag = 0;
 580   3                              
 581   3                                          Sleep_Position_Flag        = 0;
 582   3                                                                              Set_Sleep_Position_Flag    = 0;
 583   3      
 584   3                                                                              Watch_TV_Position_Flag     = 0;
 585   3                                                                              Set_Watch_TV_Position_Flag = 0;
 586   3      
 587   3                                                                              Reading_Position_Flag      = 0;
 588   3                                                                              Set_Reading_Position_Flag  = 0;
 589   3                                          #endif
 590   3                                                break;
 591   3                              case COCO_Close:                                                       //座椅收回
 592   3                                                #if 1
 593   3                                          PUSH_RESET_FLAG   = 0;
 594   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 595   3                                                                              LUMBER_CLOSE_FLAG = 0;
 596   3                                                                              HEAD_OPEN_FLAG    = 0;
 597   3                                                                              HEAD_CLOSE_FLAG   = 0;
 598   3                                                                              PUSH_OPEN_FLAG    = 0;
 599   3                                                                              PUSH_CLOSE_FLAG   = 1;
 600   3                                                                              PUSH_STOP_FLAG    = 0;
 601   3                                                                              FOOT_STATUS_FLAG  = 0;
 602   3                                                                              COOL_STATUS_FLAG  = 0;
 603   3                                          Close_Foot_Led_Flag = 0;
 604   3                              
 605   3                                          Mass_Open_Flag  = 0;
 606   3                                                                              Mass_Close_Flag = 0;
 607   3                                                                              Heat_Open_Flag  = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 11  

 608   3                                                                              Heat_Close_Flag = 0;
 609   3                              
 610   3                                          Sleep_Position_Flag        = 0;
 611   3                                                                              Set_Sleep_Position_Flag    = 0;
 612   3      
 613   3                                                                              Watch_TV_Position_Flag     = 0;
 614   3                                                                              Set_Watch_TV_Position_Flag = 0;
 615   3      
 616   3                                                                              Reading_Position_Flag      = 0;
 617   3                                                                              Set_Reading_Position_Flag  = 0;
 618   3                                          #endif
 619   3                                                break;
 620   3                              case COCO_Home_Position:                                 //座椅复位
 621   3                                                #if 1         
 622   3                                          PUSH_RESET_FLAG   = 1;
 623   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 624   3                                                                              LUMBER_CLOSE_FLAG = 0;
 625   3                                                                              HEAD_OPEN_FLAG    = 0;
 626   3                                                                              HEAD_CLOSE_FLAG   = 0;
 627   3                                                                              PUSH_OPEN_FLAG    = 0;
 628   3                                                                              PUSH_CLOSE_FLAG   = 0;
 629   3                                                                              PUSH_STOP_FLAG    = 0;
 630   3                                                                              FOOT_STATUS_FLAG  = 0;
 631   3                                                                              COOL_STATUS_FLAG  = 0;
 632   3                                          Close_Foot_Led_Flag = 0;
 633   3                              
 634   3                                          Mass_Open_Flag  = 0;
 635   3                                                                              Mass_Close_Flag = 0;
 636   3                                                                              Heat_Open_Flag  = 0;
 637   3                                                                              Heat_Close_Flag = 0;
 638   3                                                
 639   3                                          Sleep_Position_Flag        = 0;
 640   3                                                                              Set_Sleep_Position_Flag    = 0;
 641   3      
 642   3                                                                              Watch_TV_Position_Flag     = 0;
 643   3                                                                              Set_Watch_TV_Position_Flag = 0;
 644   3      
 645   3                                                                              Reading_Position_Flag      = 0;
 646   3                                                                              Set_Reading_Position_Flag  = 0;
 647   3                                      #endif
 648   3                                                break;
 649   3                              case COCO_Head_Up:                                 //头枕打开
 650   3                                                #if 1                 
 651   3                                          PUSH_RESET_FLAG   = 0;
 652   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 653   3                                                                              LUMBER_CLOSE_FLAG = 0;
 654   3                                                                              HEAD_OPEN_FLAG    = 1;
 655   3                                                                              HEAD_CLOSE_FLAG   = 0;
 656   3                                                                              PUSH_OPEN_FLAG    = 0;
 657   3                                                                              PUSH_CLOSE_FLAG   = 0;
 658   3                                                                              PUSH_STOP_FLAG    = 0;
 659   3                                                                              FOOT_STATUS_FLAG  = 0;
 660   3                                                                              COOL_STATUS_FLAG  = 0;
 661   3                                          Close_Foot_Led_Flag = 0;
 662   3                              
 663   3                                          Mass_Open_Flag  = 0;
 664   3                                                                              Mass_Close_Flag = 0;
 665   3                                                                              Heat_Open_Flag  = 0;
 666   3                                                                              Heat_Close_Flag = 0;
 667   3                              
 668   3                                          Sleep_Position_Flag        = 0;
 669   3                                                                              Set_Sleep_Position_Flag    = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 12  

 670   3      
 671   3                                                                              Watch_TV_Position_Flag     = 0;
 672   3                                                                              Set_Watch_TV_Position_Flag = 0;
 673   3      
 674   3                                                                              Reading_Position_Flag      = 0;
 675   3                                                                              Set_Reading_Position_Flag  = 0;
 676   3                                          #endif
 677   3                                                break;
 678   3                              case COCO_Head_Down:                                 //头枕收回
 679   3                                                #if 1         
 680   3                                          PUSH_RESET_FLAG   = 0;            
 681   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 682   3                                                                              LUMBER_CLOSE_FLAG = 0;
 683   3                                                                              HEAD_OPEN_FLAG    = 0;
 684   3                                                                              HEAD_CLOSE_FLAG   = 1;
 685   3                                                                              PUSH_OPEN_FLAG    = 0;
 686   3                                                                              PUSH_CLOSE_FLAG   = 0;
 687   3                                                                              PUSH_STOP_FLAG    = 0;
 688   3                                                                              FOOT_STATUS_FLAG  = 0;
 689   3                                                                              COOL_STATUS_FLAG  = 0;
 690   3                                          Close_Foot_Led_Flag = 0;
 691   3                              
 692   3                                          Mass_Open_Flag  = 0;
 693   3                                                                              Mass_Close_Flag = 0;
 694   3                                                                              Heat_Open_Flag  = 0;
 695   3                                                                              Heat_Close_Flag = 0;
 696   3                              
 697   3                                          Sleep_Position_Flag        = 0;
 698   3                                                                              Set_Sleep_Position_Flag    = 0;
 699   3      
 700   3                                                                              Watch_TV_Position_Flag     = 0;
 701   3                                                                              Set_Watch_TV_Position_Flag = 0;
 702   3      
 703   3                                                                              Reading_Position_Flag      = 0;
 704   3                                                                              Set_Reading_Position_Flag  = 0;
 705   3                                          #endif
 706   3                                                break;
 707   3                              case COCO_Light_On:                                 //脚灯开
 708   3                                                #if 0                 
                                                  PUSH_RESET_FLAG   = 0;            
                                                                                      LUMBER_OPEN_FLAG  = 0; 
                                                                                      LUMBER_CLOSE_FLAG = 0;
                                                                                      HEAD_OPEN_FLAG    = 0;
                                                                                      HEAD_CLOSE_FLAG   = 0;
                                                                                      PUSH_OPEN_FLAG    = 0;
                                                                                      PUSH_CLOSE_FLAG   = 0;
                                                                                      PUSH_STOP_FLAG    = 0;
                                                                                      FOOT_STATUS_FLAG  = 1;
                                                                                      COOL_STATUS_FLAG  = 0;
                                                  Close_Foot_Led_Flag = 0;
                                      
                                                  Mass_Open_Flag  = 0;
                                                                                      Mass_Close_Flag = 0;
                                                                                      Heat_Open_Flag  = 0;
                                                                                      Heat_Close_Flag = 0;
                                      
                                                  Sleep_Position_Flag        = 0;
                                                                                      Set_Sleep_Position_Flag    = 0;
              
                                                                                      Watch_TV_Position_Flag     = 0;
                                                                                      Set_Watch_TV_Position_Flag = 0;
              
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 13  

                                                                                      Reading_Position_Flag      = 0;
                                                                                      Set_Reading_Position_Flag  = 0;
                                                  #endif
 735   3                                                break;
 736   3                              case COCO_Light_Off:                                 //脚灯关
 737   3                                                #if 0                 
                                                  PUSH_RESET_FLAG   = 0;            
                                                                                      LUMBER_OPEN_FLAG  = 0; 
                                                                                      LUMBER_CLOSE_FLAG = 0;
                                                                                      HEAD_OPEN_FLAG    = 0;
                                                                                      HEAD_CLOSE_FLAG   = 0;
                                                                                      PUSH_OPEN_FLAG    = 0;
                                                                                      PUSH_CLOSE_FLAG   = 0;
                                                                                      PUSH_STOP_FLAG    = 0;
                                                                                      FOOT_STATUS_FLAG  = 0;
                                                                                      COOL_STATUS_FLAG  = 0;
                                                  Close_Foot_Led_Flag = 1;
                                      
                                                  Mass_Open_Flag  = 0;
                                                                                      Mass_Close_Flag = 0;
                                                                                      Heat_Open_Flag  = 0;
                                                                                      Heat_Close_Flag = 0;
                                      
                                                  Sleep_Position_Flag        = 0;
                                                                                      Set_Sleep_Position_Flag    = 0;
              
                                                                                      Watch_TV_Position_Flag     = 0;
                                                                                      Set_Watch_TV_Position_Flag = 0;
              
                                                                                      Reading_Position_Flag      = 0;
                                                                                      Set_Reading_Position_Flag  = 0;
                                                  #endif
 764   3                                                break;
 765   3                              case COCO_Lumbar_Up:
 766   3                                                #if 1                               //腰靠打开
 767   3                                          PUSH_RESET_FLAG   = 0;            
 768   3                                                                              LUMBER_OPEN_FLAG  = 1; 
 769   3                                                                              LUMBER_CLOSE_FLAG = 0;
 770   3                                                                              HEAD_OPEN_FLAG    = 0;
 771   3                                                                              HEAD_CLOSE_FLAG   = 0;
 772   3                                                                              PUSH_OPEN_FLAG    = 0;
 773   3                                                                              PUSH_CLOSE_FLAG   = 0;
 774   3                                                                              PUSH_STOP_FLAG    = 0;
 775   3                                                                              FOOT_STATUS_FLAG  = 0;
 776   3                                                                              COOL_STATUS_FLAG  = 0;
 777   3                                          Close_Foot_Led_Flag = 0;
 778   3                              
 779   3                                          Mass_Open_Flag  = 0;
 780   3                                                                              Mass_Close_Flag = 0;
 781   3                                                                              Heat_Open_Flag  = 0;
 782   3                                                                              Heat_Close_Flag = 0;
 783   3                              
 784   3                                          Sleep_Position_Flag        = 0;
 785   3                                                                              Set_Sleep_Position_Flag    = 0;
 786   3      
 787   3                                                                              Watch_TV_Position_Flag     = 0;
 788   3                                                                              Set_Watch_TV_Position_Flag = 0;
 789   3      
 790   3                                                                              Reading_Position_Flag      = 0;
 791   3                                                                              Set_Reading_Position_Flag  = 0;
 792   3                                          #endif
 793   3                                                break;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 14  

 794   3                              case COCO_Lumbar_Down:
 795   3                                                #if 1                    //腰靠收回                                                                   
 796   3                                                                              PUSH_RESET_FLAG   = 0;            
 797   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 798   3                                                                              LUMBER_CLOSE_FLAG = 1;
 799   3                                                                              HEAD_OPEN_FLAG    = 0;
 800   3                                                                              HEAD_CLOSE_FLAG   = 0;
 801   3                                                                              PUSH_OPEN_FLAG    = 0;
 802   3                                                                              PUSH_CLOSE_FLAG   = 0;
 803   3                                                                              PUSH_STOP_FLAG    = 0;
 804   3                                                                              FOOT_STATUS_FLAG  = 0;
 805   3                                                                              COOL_STATUS_FLAG  = 0;
 806   3                                          Close_Foot_Led_Flag = 0;
 807   3                              
 808   3                                          Mass_Open_Flag  = 0;
 809   3                                                                              Mass_Close_Flag = 0;
 810   3                                                                              Heat_Open_Flag  = 0;
 811   3                                                                              Heat_Close_Flag = 0;
 812   3                              
 813   3                                          Sleep_Position_Flag        = 0;
 814   3                                                                              Set_Sleep_Position_Flag    = 0;
 815   3      
 816   3                                                                              Watch_TV_Position_Flag     = 0;
 817   3                                                                              Set_Watch_TV_Position_Flag = 0;
 818   3      
 819   3                                                                              Reading_Position_Flag      = 0;
 820   3                                                                              Set_Reading_Position_Flag  = 0;
 821   3                                          #endif
 822   3                                                break;
 823   3                              case COCO_Sleep_Position://睡眠位置
 824   3                                                PUSH_RESET_FLAG   = 0;            
 825   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 826   3                                                                              LUMBER_CLOSE_FLAG = 0;
 827   3                                                                              HEAD_OPEN_FLAG    = 0;
 828   3                                                                              HEAD_CLOSE_FLAG   = 0;
 829   3                                                                              PUSH_OPEN_FLAG    = 0;
 830   3                                                                              PUSH_CLOSE_FLAG   = 0;
 831   3                                                                              PUSH_STOP_FLAG    = 0;
 832   3                                                                              FOOT_STATUS_FLAG  = 0;
 833   3                                                                              COOL_STATUS_FLAG  = 0;
 834   3                                          Close_Foot_Led_Flag = 0;
 835   3                              
 836   3                                          Mass_Open_Flag  = 0;
 837   3                                                                              Mass_Close_Flag = 0;
 838   3                                                                              Heat_Open_Flag  = 0;
 839   3                                                                              Heat_Close_Flag = 0;
 840   3                              
 841   3                                          Sleep_Position_Flag        = 1;
 842   3                                                                              Set_Sleep_Position_Flag    = 0;
 843   3      
 844   3                                                                              Watch_TV_Position_Flag     = 0;
 845   3                                                                              Set_Watch_TV_Position_Flag = 0;
 846   3      
 847   3                                                                              Reading_Position_Flag      = 0;
 848   3                                                                              Set_Reading_Position_Flag  = 0;
 849   3                                                break;
 850   3                              case COCO_TV_Position://看电视位置
 851   3                                                PUSH_RESET_FLAG   = 0;            
 852   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 853   3                                                                              LUMBER_CLOSE_FLAG = 0;
 854   3                                                                              HEAD_OPEN_FLAG    = 0;
 855   3                                                                              HEAD_CLOSE_FLAG   = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 15  

 856   3                                                                              PUSH_OPEN_FLAG    = 0;
 857   3                                                                              PUSH_CLOSE_FLAG   = 0;
 858   3                                                                              PUSH_STOP_FLAG    = 0;
 859   3                                                                              FOOT_STATUS_FLAG  = 0;
 860   3                                                                              COOL_STATUS_FLAG  = 0;
 861   3                                          Close_Foot_Led_Flag = 0;
 862   3                              
 863   3                                          Mass_Open_Flag  = 0;
 864   3                                                                              Mass_Close_Flag = 0;
 865   3                                                                              Heat_Open_Flag  = 0;
 866   3                                                                              Heat_Close_Flag = 0;
 867   3                              
 868   3                                          Sleep_Position_Flag        = 0;
 869   3                                                                              Set_Sleep_Position_Flag    = 0;
 870   3      
 871   3                                                                              Watch_TV_Position_Flag     = 1;
 872   3                                                                              Set_Watch_TV_Position_Flag = 0;
 873   3      
 874   3                                                                              Reading_Position_Flag      = 0;
 875   3                                                                              Set_Reading_Position_Flag  = 0; 
 876   3                                          break;
 877   3                              case COCO_Reading_Position://阅读位置
 878   3                                                PUSH_RESET_FLAG   = 0;            
 879   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 880   3                                                                              LUMBER_CLOSE_FLAG = 0;
 881   3                                                                              HEAD_OPEN_FLAG    = 0;
 882   3                                                                              HEAD_CLOSE_FLAG   = 0;
 883   3                                                                              PUSH_OPEN_FLAG    = 0;
 884   3                                                                              PUSH_CLOSE_FLAG   = 0;
 885   3                                                                              PUSH_STOP_FLAG    = 0;
 886   3                                                                              FOOT_STATUS_FLAG  = 0;
 887   3                                                                              COOL_STATUS_FLAG  = 0;
 888   3                                          Close_Foot_Led_Flag = 0;
 889   3                              
 890   3                                          Mass_Open_Flag  = 0;
 891   3                                                                              Mass_Close_Flag = 0;
 892   3                                                                              Heat_Open_Flag  = 0;
 893   3                                                                              Heat_Close_Flag = 0;
 894   3                              
 895   3                                          Sleep_Position_Flag        = 0;
 896   3                                                                              Set_Sleep_Position_Flag    = 0;
 897   3      
 898   3                                                                              Watch_TV_Position_Flag     = 0;
 899   3                                                                              Set_Watch_TV_Position_Flag = 0;
 900   3      
 901   3                                                                              Reading_Position_Flag      = 1;
 902   3                                                                              Set_Reading_Position_Flag  = 0;
 903   3                                          break;
 904   3                              case COCO_Set_Sleep_Position://记忆睡眠位置
 905   3                                                PUSH_RESET_FLAG   = 0;            
 906   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 907   3                                                                              LUMBER_CLOSE_FLAG = 0;
 908   3                                                                              HEAD_OPEN_FLAG    = 0;
 909   3                                                                              HEAD_CLOSE_FLAG   = 0;
 910   3                                                                              PUSH_OPEN_FLAG    = 0;
 911   3                                                                              PUSH_CLOSE_FLAG   = 0;
 912   3                                                                              PUSH_STOP_FLAG    = 0;
 913   3                                                                              FOOT_STATUS_FLAG  = 0;
 914   3                                                                              COOL_STATUS_FLAG  = 0;
 915   3                                          Close_Foot_Led_Flag = 0;
 916   3                              
 917   3                                          Mass_Open_Flag  = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 16  

 918   3                                                                              Mass_Close_Flag = 0;
 919   3                                                                              Heat_Open_Flag  = 0;
 920   3                                                                              Heat_Close_Flag = 0;
 921   3                              
 922   3                                          Sleep_Position_Flag        = 0;
 923   3                                                                              Set_Sleep_Position_Flag    = 1;
 924   3      
 925   3                                                                              Watch_TV_Position_Flag     = 0;
 926   3                                                                              Set_Watch_TV_Position_Flag = 0;
 927   3      
 928   3                                                                              Reading_Position_Flag      = 0;
 929   3                                                                              Set_Reading_Position_Flag  = 0;
 930   3                                          break;
 931   3                              case COCO_Set_TV_Position://记忆看电视位置
 932   3                                                PUSH_RESET_FLAG   = 0;            
 933   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 934   3                                                                              LUMBER_CLOSE_FLAG = 0;
 935   3                                                                              HEAD_OPEN_FLAG    = 0;
 936   3                                                                              HEAD_CLOSE_FLAG   = 0;
 937   3                                                                              PUSH_OPEN_FLAG    = 0;
 938   3                                                                              PUSH_CLOSE_FLAG   = 0;
 939   3                                                                              PUSH_STOP_FLAG    = 0;
 940   3                                                                              FOOT_STATUS_FLAG  = 0;
 941   3                                                                              COOL_STATUS_FLAG  = 0;
 942   3                                          Close_Foot_Led_Flag = 0;
 943   3                              
 944   3                                          Mass_Open_Flag  = 0;
 945   3                                                                              Mass_Close_Flag = 0;
 946   3                                                                              Heat_Open_Flag  = 0;
 947   3                                                                              Heat_Close_Flag = 0;
 948   3                              
 949   3                                          Sleep_Position_Flag        = 0;
 950   3                                                                              Set_Sleep_Position_Flag    = 0;
 951   3      
 952   3                                                                              Watch_TV_Position_Flag     = 0;
 953   3                                                                              Set_Watch_TV_Position_Flag = 1;
 954   3      
 955   3                                                                              Reading_Position_Flag      = 0;
 956   3                                                                              Set_Reading_Position_Flag  = 0;
 957   3                                          break;
 958   3                              case COCO_Set_Reading_Position://记忆阅读位置
 959   3                                                PUSH_RESET_FLAG   = 0;            
 960   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 961   3                                                                              LUMBER_CLOSE_FLAG = 0;
 962   3                                                                              HEAD_OPEN_FLAG    = 0;
 963   3                                                                              HEAD_CLOSE_FLAG   = 0;
 964   3                                                                              PUSH_OPEN_FLAG    = 0;
 965   3                                                                              PUSH_CLOSE_FLAG   = 0;
 966   3                                                                              PUSH_STOP_FLAG    = 0;
 967   3                                                                              FOOT_STATUS_FLAG  = 0;
 968   3                                                                              COOL_STATUS_FLAG  = 0;
 969   3                                          Close_Foot_Led_Flag = 0;
 970   3                              
 971   3                                          Mass_Open_Flag  = 0;
 972   3                                                                              Mass_Close_Flag = 0;
 973   3                                                                              Heat_Open_Flag  = 0;
 974   3                                                                              Heat_Close_Flag = 0;
 975   3                              
 976   3                                          Sleep_Position_Flag        = 0;
 977   3                                                                              Set_Sleep_Position_Flag    = 0;
 978   3      
 979   3                                                                              Watch_TV_Position_Flag     = 0;
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 17  

 980   3                                                                              Set_Watch_TV_Position_Flag = 0;
 981   3      
 982   3                                                                              Reading_Position_Flag      = 0;
 983   3                                                                              Set_Reading_Position_Flag  = 1;
 984   3                                          break;
 985   3                              default:
 986   3                                                PUSH_RESET_FLAG   = 0;            
 987   3                                                                              LUMBER_OPEN_FLAG  = 0; 
 988   3                                                                              LUMBER_CLOSE_FLAG = 0;
 989   3                                                                              HEAD_OPEN_FLAG    = 0;
 990   3                                                                              HEAD_CLOSE_FLAG   = 0;
 991   3                                                                              PUSH_OPEN_FLAG    = 0;
 992   3                                                                              PUSH_CLOSE_FLAG   = 0;
 993   3                                                                              PUSH_STOP_FLAG    = 1;
 994   3                                                                              FOOT_STATUS_FLAG  = 0;
 995   3                                                                              COOL_STATUS_FLAG  = 0;
 996   3                                          Close_Foot_Led_Flag = 0;
 997   3                              
 998   3                                          Mass_Open_Flag  = 0;
 999   3                                                                              Mass_Close_Flag = 0;
1000   3                                                                              Heat_Open_Flag  = 0;
1001   3                                                                              Heat_Close_Flag = 0;
1002   3                              
1003   3                                          Sleep_Position_Flag        = 0;
1004   3                                                                              Set_Sleep_Position_Flag    = 0;
1005   3      
1006   3                                                                              Watch_TV_Position_Flag     = 0;
1007   3                                                                              Set_Watch_TV_Position_Flag = 0;
1008   3      
1009   3                                                                              Reading_Position_Flag      = 0;
1010   3                                                                              Set_Reading_Position_Flag  = 0;
1011   3                                                break;
1012   3                         }
1013   2      
1014   2               }
1015   1      }
1016          
1017          void System_Init(void)
1018          {
1019   1              TimeOutDet_Init();
1020   1              BackCall_Key(Key_Init);
1021   1              Led_Init();
1022   1              Timer_Init();
1023   1              BackCall_Uart1(12,Uart1_Init);
1024   1              WatchDog();
1025   1              Interrupt_Init();
1026   1      }
1027          
1028          void System_Handle(void)
1029          {
1030   1              WatchDog_Clear();
1031   1              Rev_Data_Handle();
1032   1              Key_Scanf();
1033   1              if(TimeOutDet_Check(&TimeOut_Para[0]))
1034   1              {
1035   2                      TimeOut_Record(&TimeOut_Para[0],OnLine_Time);
1036   2                      Key_Handle();
1037   2              }
1038   1      }
1039          
1040          /**************************************************
1041          *函数名称：void timer0/1/2() interrupt 1/3/5
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/29/2018 18:01:54 PAGE 18  

1042          *函数功能：定时器中断产生方波
1043          *入口参数：void
1044          *出口参数：void
1045          **************************************************/
1046          void timer0() interrupt 1
1047          {
1048   1        TL0 = (65536 - 5900)%256;
1049   1              TH0 = (65536 - 5900)/256;       
1050   1              TimeOutDet_DecHandle();
1051   1      
1052   1      }
1053          
1054          void timer1() interrupt 3
1055          {
1056   1      
1057   1      }
1058          
1059          void Timer2Int(void) interrupt 5
1060          {               
1061   1              TF2 = 0;   //溢出清零
1062   1      
1063   1      }
1064          
1065          void Uart1_Int() interrupt 7   //Uart1中断函数
1066          {
1067   1      
1068   1              if(SSCON0&0x02)    //发送标志位判断
1069   1              {
1070   2                      SSCON0 &= 0xFD;
1071   2                      Uart1SendFlag = 1;
1072   2              }
1073   1              if((SSCON0&0x01))  //接收标志位判断
1074   1              {
1075   2                      SSCON0 &= 0xFE;
1076   2                      Uart1ReceiveFlag = 1;
1077   2                Serial_Rev_IQH();
1078   2              }       
1079   1      }
1080          
1081          
1082          
1083          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1760    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     87    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
